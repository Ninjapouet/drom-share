; generated by drom from package skeleton 'library'

(library
  (name !{library-name})
  (public_name !{name})
  (wrapped !{pack-modules})
  (libraries !{dune-libraries} !(package-dune-libraries))
  (foreign_stubs
    (language c)
    (names !(c-names))
    !(c-flags))
  (c_library_flags !(c-library-flags))
  !{dune-stanzas}
  !(package-dune-stanzas)
  )

(rule
  (deps build_wasm.sh !(c-names-dot-c))
  (targets !{name}.js !{name}.wasm)
  (action (system "./build_wasm.sh -p . -o !{name}.js")))

(library
  (name !{library-name}_js)
  (public_name !{name}.js)
  (modules)
  (modes byte)
  (libraries !{library-name})
  (js_of_ocaml
    (javascript_files !{name}.js wasm_utils.js stubs.js)
    (flags --no-sourcemap))
  !{dune-stanzas}
  !(package-dune-stanzas))

(install
 (files (!{name}.wasm as www/js/!{name}.wasm))
 (section share)
 (package !{name}))

!{package-dune-files}
(documentation
  (package !{package-name}))
!{package-dune-installs}
!(package-dune-trailer)
